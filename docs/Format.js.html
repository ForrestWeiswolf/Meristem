<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Format.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Format.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * The format according to which text will be generated.
 * @constructor
 * @param {string} formatString - A string which may contain 'nonterminals' - text enclosed
 * in parentheses which will be replaced with a specified or randomly chosen substring
 * @param {object} definitions - An object assosciating nonterminals as keys with
 * the values they will be replaced with. If the value is a [WeightedRandom]{@link WeightedRandom},
 * its .choose method will be called and the result inserted instead; if it is a Format
 * its .expand method will be called and the result inserted.
 */
function Format(formatString, definitions) {
  if (typeof formatString === 'undefined') {
    throw new Error('No argument passed to Format constructor')
  } else if (formatString === null) {
    throw new Error('Format constructor was passed null instead of string')
  } else if (typeof formatString !== 'string') {
    throw new Error(`Format constructor was passed ${typeof formatString} instead of string`)
  } else if (!checkParens(formatString)) {
    throw new Error('Mismatched parentheses in Format string')
  } else if (formatString.includes('()')) {
    throw new Error('Empty parentheses in Format string')
  }

  this.formatString = formatString
  this.definitions = definitions
  this.separators = { start: '(', end: ')' }
}

/** Generate text according to the format.
 * @param {object} definitionsArg - Optional; will be used if no definitions were passed to the constructor
*/
Format.prototype.expand = function (definitionsArg) {
  let result = '';
  let definitions = this.definitions || definitionsArg
  if (!definitions) {
    throw new Error('This.definitions does not exist and no definitions argument passed')
  }

  this.formatString.split(this.separators.end) //splits into sections ending with a nonterminal
    .forEach((section) => {
      const splitSection = section.split(this.separators.start) //splits into arrays where first member is text and second is nonterminal 
      const text = splitSection[0]
      const nonterminal = splitSection[1]
      if (text) result += text
      result += this.handleNonterminal(nonterminal, definitions)

    })
  return result;
}

Format.prototype.handleNonterminal = function (nonterminalStr, definitions) {
  if (!nonterminalStr) {
    return ''
  } else if (!definitions[nonterminalStr]) {
    throw new Error(`"${nonterminalStr}" not found in definitions`)
  } else {

    let nonterminal = definitions[nonterminalStr]

    if (typeof nonterminal === 'string') {
      return new Format(nonterminal, definitions).expand()
    } else if (typeof nonterminal === 'object' &amp;&amp; nonterminal.expand) {
      return nonterminal.expand(definitions)
    } else if (typeof nonterminal === 'object' &amp;&amp; nonterminal.choose) {
      //let choice = nonterminal.choose()
      //return typeof choice === 'string' ? choice : 
      return new Format(nonterminal.choose(), definitions).expand()
    }

  }
}

function checkParens(str) {
  let parensOpen = 0
  for (i = 0; i &lt; str.length; i++) {
    if (str.charAt(i) === '(') {
      parensOpen++
    } else if (str.charAt(i) === ')') {
      parensOpen--
    }

    if (parensOpen &lt; 0) {
      return false
    }
  }

  if (parensOpen !== 0) {
    return false
  } else {
    return true
  }
}
module.exports = Format
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Format.html">Format</a></li><li><a href="FrozenRandom.html">FrozenRandom</a></li><li><a href="WeightedRandom.html">WeightedRandom</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Oct 16 2018 11:21:46 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
